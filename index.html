<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestMenter - Advanced SOA Generator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .form-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .statement-preview {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logo-container {
            text-align: center;
            margin-bottom: 15px;
        }

        .logo {
            max-width: 250px;
            height: auto;
        }

        h1 {
            color: #333;
            margin-bottom: 25px;
            font-size: 28px;
        }

        h2 {
            color: #333;
            text-align: center;
            margin: 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            font-weight: bold;
        }

        h3 {
            color: #333;
            margin: 20px 0 15px 0;
            font-size: 18px;
        }

        .section-header {
            background: #C9A961;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 25px 0 15px 0;
            font-size: 16px;
            font-weight: 600;
        }

        .document-info {
            text-align: right;
            margin-bottom: 15px;
            font-size: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #C9A961;
        }

        .row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .row-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .info-row {
            display: grid;
            grid-template-columns: 180px 1fr;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .info-label {
            font-weight: 500;
        }

        .info-value {
            color: #666;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 11px;
        }

        th {
            background: #D4C5A0;
            padding: 8px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #ccc;
        }

        td {
            padding: 6px 8px;
            border: 1px solid #ccc;
        }

        .highlight-row {
            background: #FFFF00;
            font-weight: bold;
        }

        .note-section {
            margin-top: 15px;
            font-size: 9px;
            line-height: 1.5;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #C9A961;
            color: white;
        }

        .btn-primary:hover {
            background: #B89951;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-add {
            padding: 8px 16px;
            font-size: 14px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-add:hover {
            background: #218838;
        }

        .btn-remove {
            padding: 4px 8px;
            font-size: 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        .expense-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }

        .expense-table th {
            background: #C9A961;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-size: 13px;
        }

        .expense-table td {
            padding: 8px;
            border: 1px solid #ddd;
        }

        .expense-table input, .expense-table select {
            width: 100%;
            padding: 6px;
            font-size: 13px;
        }

        .unit-item {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #4a90e2;
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4a90e2;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .amount-input {
            text-align: right;
        }

        .property-type-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .property-type-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .property-type-option:hover {
            border-color: #C9A961;
        }

        .property-type-option.active {
            border-color: #C9A961;
            background: #C9A961;
            color: white;
        }

        .buyer-seller-type {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .type-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .type-option {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .type-option:hover {
            border-color: #C9A961;
        }

        .type-option.active {
            border-color: #C9A961;
            background: #f9f9f9;
            font-weight: 600;
        }

        @media print {
            body {
                background: white;
            }
            .form-section, .btn-group {
                display: none;
            }
            .statement-preview {
                box-shadow: none;
                padding: 15px;
                page-break-after: always;
            }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-weight: 600;
        }

        .tab.active {
            background: #C9A961;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 12px;
            margin: 15px 0;
            font-size: 13px;
        }

        .breakdown-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .breakdown-row.total {
            font-weight: bold;
            font-size: 16px;
            border-top: 2px solid #333;
            border-bottom: 2px solid #333;
            margin-top: 10px;
            padding-top: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function SOAGenerator() {
            const [propertyType, setPropertyType] = useState('offplan'); // offplan, ready-cash, ready-mortgage
            const [buyerType, setBuyerType] = useState('cash'); // cash, mortgage
            const [sellerType, setSellerType] = useState('cash'); // cash, mortgage

            const [formData, setFormData] = useState({
                sellersName: '',
                buyerName: '',
                propertyAddress: '',
                estimatedTransferDate: '',
                transferLocation: '',
                documentDate: new Date().toLocaleDateString('en-GB'),
                preparedBy: 'Mackie',
                brokerPercentage: '2'
            });

            const [units, setUnits] = useState([
                { 
                    id: 1, 
                    name: '', 
                    sellingPrice: '', 
                    purchasePrice: '', 
                    installmentPaid: '',
                    buyerPaidToDeveloper: '',
                    folAmount: '' // For mortgage registration calculation
                }
            ]);

            const [buyerExpenses, setBuyerExpenses] = useState([]);
            const [sellerExpenses, setSellerExpenses] = useState([]);

            const [generated, setGenerated] = useState(false);
            const [activeTab, setActiveTab] = useState('buyer');

            // Automatically add Sales Progression Fee and Handling Admin Fee
            useEffect(() => {
                setBuyerExpenses(prev => {
                    // Remove old auto-added fees to update them
                    let filtered = prev.filter(exp => 
                        exp.id !== 'sales-progression-auto' && 
                        exp.id !== 'handling-admin-auto'
                    );
                    
                    // Add Sales Progression Fee (editable)
                    const salesProgressionAmount = getSalesProgressionFee();
                    filtered.push({
                        id: 'sales-progression-auto',
                        expenseType: 'sales-progression',
                        description: 'Sales Progression Fee incl. 5% VAT',
                        amount: (salesProgressionAmount % 1 === 0) ? salesProgressionAmount.toString() : salesProgressionAmount.toFixed(2),
                        mode: "Manager's Cheque",
                        payee: "Next Level Consulting - FZCO"
                    });
                    
                    // Add Handling Admin Fee (fixed)
                    filtered.push({
                        id: 'handling-admin-auto',
                        expenseType: 'handling-admin',
                        description: 'Handling Admin Fee incl. 5% VAT',
                        amount: '4198.95',
                        mode: "Manager's Cheque",
                        payee: "Next Level Consulting - FZCO"
                    });
                    
                    return filtered;
                });
            }, [buyerType, sellerType]); // Update when buyer/seller type changes

            // Automatically add DLD Mortgage Registration Fee for Ready/Mortgage
            useEffect(() => {
                if (propertyType === 'ready-mortgage') {
                    // Check if it's not already added
                    setBuyerExpenses(prev => {
                        const hasMortgageFee = prev.some(exp => exp.id === 'mortgage-registration-auto');
                        if (!hasMortgageFee) {
                            return [...prev, {
                                id: 'mortgage-registration-auto',
                                expenseType: 'mortgage-registration',
                                description: 'DLD Mortgage Registration Fee (0.25% from FOL amount + AED 290 Admin Fee)',
                                amount: 'TO BE CONFIRMED',
                                mode: "Manager's Cheque",
                                payee: "Dubai Land Department"
                            }];
                        }
                        return prev;
                    });
                } else {
                    // Remove mortgage registration fee if property type changes
                    setBuyerExpenses(prev => prev.filter(exp => exp.id !== 'mortgage-registration-auto'));
                }
            }, [propertyType]); // Only depend on propertyType

            // Payment modes
            const paymentModes = [
                "Manager's Cheque",
                "Bank Transfer",
                "Cash/Card",
                "Cash",
                "Cheque"
            ];

            // Payee options
            const payeeOptions = [
                "Investmenter Real Estate LLC",
                "Next Level Consulting - FZCO",
                "Dubai Land Department",
                "Trustee Office",
                "Other"
            ];

            // Calculate Sales Progression Fee based on buyer/seller types
            const getSalesProgressionFee = () => {
                const baseAmount = {
                    'cash-cash': 3000,
                    'mortgage-cash': 4500,
                    'cash-mortgage': 4500,
                    'mortgage-mortgage': 6000
                }[`${buyerType}-${sellerType}`] || 3000;
                
                return baseAmount * 1.05; // Add 5% VAT
            };

            // Calculate POA Fee
            const getPOAFee = (hasEmiratesID) => {
                const baseAmount = hasEmiratesID ? 3000 : 4000;
                return baseAmount * 1.05; // Add 5% VAT
            };

            // Get DLD Admin Fee based on property type
            const getDLDAdminFee = () => {
                return propertyType === 'offplan' ? 40 : 580;
            };

            // Get DLD Trustee Fee based on property type
            const getDLDTrusteeFee = () => {
                return propertyType === 'offplan' ? 5250 : 4200;
            };

            // Calculate Handling Admin Fee
            const getHandlingAdminFee = () => {
                return 4198.95;
            };

            // Calculate Mortgage Registration Fee (only for ready-mortgage)
            const getMortgageRegistrationFee = (folAmount) => {
                if (propertyType !== 'ready-mortgage' || !folAmount) return 0;
                return (parseFloat(folAmount) * 0.0025) + 290;
            };

            const addUnit = () => {
                setUnits([...units, { 
                    id: Date.now(), 
                    name: '', 
                    sellingPrice: '', 
                    purchasePrice: '', 
                    installmentPaid: '',
                    buyerPaidToDeveloper: '',
                    folAmount: ''
                }]);
            };

            const removeUnit = (id) => {
                if (units.length > 1) {
                    setUnits(units.filter(unit => unit.id !== id));
                }
            };

            const updateUnit = (id, field, value) => {
                setUnits(units.map(unit => 
                    unit.id === id ? { ...unit, [field]: value } : unit
                ));
            };

            const addBuyerExpense = () => {
                setBuyerExpenses([...buyerExpenses, {
                    id: Date.now(),
                    expenseType: 'poa-no-eid', // default selection
                    description: 'POA Fee (no Emirates ID) incl. 5% VAT',
                    amount: '4200',
                    mode: "Manager's Cheque",
                    payee: "Next Level Consulting - FZCO"
                }]);
            };

            const removeBuyerExpense = (id) => {
                // Prevent removal of auto-added expenses
                if (id === 'sales-progression-auto' || id === 'handling-admin-auto' || id === 'mortgage-registration-auto') {
                    return;
                }
                setBuyerExpenses(buyerExpenses.filter(exp => exp.id !== id));
            };

            const updateBuyerExpense = (id, field, value) => {
                setBuyerExpenses(buyerExpenses.map(exp => {
                    if (exp.id === id) {
                        if (field === 'expenseType') {
                            // Auto-fill based on expense type
                            switch(value) {
                                case 'poa-no-eid':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: 'POA Fee (no Emirates ID) incl. 5% VAT',
                                        amount: '4200',
                                        payee: 'Next Level Consulting - FZCO'
                                    };
                                case 'poa-with-eid':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: 'POA Fee (with Emirates ID) incl. 5% VAT',
                                        amount: '3150',
                                        payee: 'Next Level Consulting - FZCO'
                                    };
                                case 'managers-cheque-fee':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: "Manager's Cheque Fee (No Escrow Service) (10% Security Deposit)",
                                        amount: '1048.95',
                                        payee: 'Investmenter Real Estate LLC'
                                    };
                                case 'other':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: '',
                                        amount: ''
                                    };
                                default:
                                    return { ...exp, [field]: value };
                            }
                        }
                        return { ...exp, [field]: value };
                    }
                    return exp;
                }));
            };

            const addSellerExpense = () => {
                setSellerExpenses([...sellerExpenses, {
                    id: Date.now(),
                    expenseType: 'poa-no-eid', // default selection
                    description: 'POA Fee (no Emirates ID) incl. 5% VAT',
                    amount: '4200',
                    mode: "Manager's Cheque",
                    payee: "Next Level Consulting - FZCO"
                }]);
            };

            const removeSellerExpense = (id) => {
                setSellerExpenses(sellerExpenses.filter(exp => exp.id !== id));
            };

            const updateSellerExpense = (id, field, value) => {
                setSellerExpenses(sellerExpenses.map(exp => {
                    if (exp.id === id) {
                        if (field === 'expenseType') {
                            // Auto-fill based on expense type
                            switch(value) {
                                case 'poa-no-eid':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: 'POA Fee (no Emirates ID) incl. 5% VAT',
                                        amount: '4200',
                                        payee: 'Next Level Consulting - FZCO'
                                    };
                                case 'poa-with-eid':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: 'POA Fee (with Emirates ID) incl. 5% VAT',
                                        amount: '3150',
                                        payee: 'Next Level Consulting - FZCO'
                                    };
                                case 'managers-cheque-fee':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: "Manager's Cheque Fee (No Escrow Service) (10% Security Deposit)",
                                        amount: '1048.95',
                                        payee: 'Investmenter Real Estate LLC'
                                    };
                                case 'other':
                                    return {
                                        ...exp,
                                        expenseType: value,
                                        description: '',
                                        amount: ''
                                    };
                                default:
                                    return { ...exp, [field]: value };
                            }
                        }
                        return { ...exp, [field]: value };
                    }
                    return exp;
                }));
            };

            const getTotalSellingPrice = () => {
                return units.reduce((sum, unit) => sum + (parseFloat(unit.sellingPrice) || 0), 0);
            };

            const getTotalOutstandingBalance = () => {
                return units.reduce((sum, unit) => {
                    const purchasePrice = parseFloat(unit.purchasePrice) || 0;
                    const installmentPaid = parseFloat(unit.installmentPaid) || 0;
                    return sum + (purchasePrice - installmentPaid);
                }, 0);
            };

            const getTotalBuyerPaidToDeveloper = () => {
                return units.reduce((sum, unit) => sum + (parseFloat(unit.buyerPaidToDeveloper) || 0), 0);
            };

            const getNetToSeller = () => {
                return getTotalSellingPrice() - getTotalOutstandingBalance();
            };

            const getUnitOutstandingBalance = (unit) => {
                const purchasePrice = parseFloat(unit.purchasePrice) || 0;
                const installmentPaid = parseFloat(unit.installmentPaid) || 0;
                return purchasePrice - installmentPaid;
            };

            const getUnitNetToSeller = (unit) => {
                const sellingPrice = parseFloat(unit.sellingPrice) || 0;
                const outstandingBalance = getUnitOutstandingBalance(unit);
                return sellingPrice - outstandingBalance;
            };

            const getBrokerFee = () => {
                const totalSellingPrice = getTotalSellingPrice();
                const percentage = parseFloat(formData.brokerPercentage) || 2;
                return (totalSellingPrice * (percentage / 100)) * 1.05; // Add 5% VAT
            };

            const getDLDFee = () => {
                const totalSellingPrice = getTotalSellingPrice();
                const adminFee = getDLDAdminFee() * units.length;
                return (totalSellingPrice * 0.04) + adminFee;
            };

            const calculateBuyerTotal = () => {
                let total = 0;

                // Net to Seller
                total += getNetToSeller();

                // Outstanding balance paid by buyer to developer
                total += getTotalBuyerPaidToDeveloper();

                // DLD Fee
                total += getDLDFee();

                // DLD Trustee Fee
                total += getDLDTrusteeFee() * units.length;

                // Broker's Agency Fee
                total += getBrokerFee();

                // Custom expenses - only add if amount is a valid number
                buyerExpenses.forEach(exp => {
                    if (exp.amount && !isNaN(parseFloat(exp.amount))) {
                        total += parseFloat(exp.amount);
                    }
                });

                return total;
            };

            const calculateSellerProceeds = () => {
                const netToSeller = getNetToSeller();
                const totalBuyerPaidDeveloper = getTotalBuyerPaidToDeveloper();
                const totalOutstanding = getTotalOutstandingBalance();
                let proceeds = netToSeller;

                // Deduct Outstanding Balance
                proceeds -= (totalBuyerPaidDeveloper || totalOutstanding);

                // Broker's Agency Fee
                proceeds -= getBrokerFee();

                // Custom expenses - only deduct if amount is a valid number
                sellerExpenses.forEach(exp => {
                    if (exp.amount && !isNaN(parseFloat(exp.amount))) {
                        proceeds -= parseFloat(exp.amount);
                    }
                });

                return proceeds;
            };

            const formatCurrency = (amount) => {
                if (!amount && amount !== 0) return '';
                return new Intl.NumberFormat('en-AE', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(amount);
            };

            const handleGenerate = () => {
                setGenerated(true);
            };

            const handleReset = () => {
                setPropertyType('offplan');
                setBuyerType('cash');
                setSellerType('cash');
                setFormData({
                    sellersName: '',
                    buyerName: '',
                    propertyAddress: '',
                    estimatedTransferDate: '',
                    transferLocation: '',
                    documentDate: new Date().toLocaleDateString('en-GB'),
                    preparedBy: 'Mackie',
                    brokerPercentage: '2'
                });
                setUnits([{ 
                    id: 1, 
                    name: '', 
                    sellingPrice: '', 
                    purchasePrice: '', 
                    installmentPaid: '',
                    buyerPaidToDeveloper: '',
                    folAmount: ''
                }]);
                setBuyerExpenses([]);
                setSellerExpenses([]);
                setGenerated(false);
            };

            const downloadPDF = (type) => {
                const element = document.getElementById(`${type}-statement`);
                const opt = {
                    margin: 10,
                    filename: `${type}-statement-${formData.sellersName || 'document'}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        logging: false
                    },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save();
            };

            const renderBuyerSOA = () => {
                const totalSellingPrice = getTotalSellingPrice();
                const dldFee = getDLDFee();
                const trusteeFee = getDLDTrusteeFee() * units.length;

                return (
                    <div id="buyer-statement">
                        <div className="logo-container">
                            <img src="https://i.imgur.com/iyarNKS.png" alt="InvestMenter Logo" className="logo" crossOrigin="anonymous" />
                        </div>

                        <h2>BUYER STATEMENT OF ACCOUNT</h2>

                        <div className="document-info">
                            <div><strong>Document Date</strong> {formData.documentDate}</div>
                            <div><strong>Prepared by</strong> {formData.preparedBy}</div>
                        </div>

                        <div style={{marginBottom: '15px'}}>
                            <div className="info-row">
                                <div className="info-label">Sellers Name :</div>
                                <div className="info-value">{formData.sellersName || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Buyer Name :</div>
                                <div className="info-value">{formData.buyerName || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Property Address :</div>
                                <div className="info-value">{formData.propertyAddress || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Estimated Transfer Date :</div>
                                <div className="info-value">{formData.estimatedTransferDate || 'TO BE CONFIRMED'}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Transfer Location & Time :</div>
                                <div className="info-value">{formData.transferLocation || 'TO BE CONFIRMED'}</div>
                            </div>
                        </div>

                        <div className="info-row" style={{marginBottom: '15px'}}>
                            <div className="info-label">Selling Price</div>
                            <div className="info-value">AED {formatCurrency(totalSellingPrice)}</div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>* Description of expenses*</th>
                                    <th style={{width: '150px'}}>Amount to be Prepared By Buyer</th>
                                    <th style={{width: '150px'}}>Mode of Payment</th>
                                    <th style={{width: '180px'}}>Payee Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {units.map((unit, index) => (
                                    <tr key={unit.id}>
                                        <td>Net to Seller{unit.name ? ` - ${unit.name}` : units.length > 1 ? ` - Unit ${index + 1}` : ''}</td>
                                        <td style={{textAlign: 'right'}}>{formatCurrency(getUnitNetToSeller(unit))}</td>
                                        <td>Manager's Cheque</td>
                                        <td>Investmenter Real Estate LLC</td>
                                    </tr>
                                ))}
                                {getTotalBuyerPaidToDeveloper() > 0 && (
                                    <tr>
                                        <td>Outstanding balance for NOC clearance</td>
                                        <td style={{textAlign: 'right'}}>{formatCurrency(getTotalBuyerPaidToDeveloper())}</td>
                                        <td>Bank Transfer</td>
                                        <td>Developer</td>
                                    </tr>
                                )}
                                <tr>
                                    <td>4% DLD Fee + AED {getDLDAdminFee()} Admin Fee{units.length > 1 ? ` x ${units.length} units` : ''}</td>
                                    <td style={{textAlign: 'right'}}>{formatCurrency(dldFee)}</td>
                                    <td>Manager's Cheque</td>
                                    <td>Dubai Land Department</td>
                                </tr>
                                <tr>
                                    <td>DLD Trustee Fee{units.length > 1 ? ` for ${units.length} Units` : ''}</td>
                                    <td style={{textAlign: 'right'}}>{formatCurrency(trusteeFee)}</td>
                                    <td>Cash/Card</td>
                                    <td>Trustee Office</td>
                                </tr>
                                <tr>
                                    <td>Broker's Agency Fee incl. 5% VAT ({formData.brokerPercentage}%)</td>
                                    <td style={{textAlign: 'right'}}>{formatCurrency(getBrokerFee())}</td>
                                    <td>Manager's Cheque</td>
                                    <td>Investmenter Real Estate LLC</td>
                                </tr>
                                {buyerExpenses.map(exp => {
                                    const hasValidAmount = exp.amount && (!isNaN(parseFloat(exp.amount)) || exp.amount === 'TO BE CONFIRMED');
                                    const isNumeric = exp.amount && !isNaN(parseFloat(exp.amount));
                                    
                                    return hasValidAmount ? (
                                        <tr key={exp.id}>
                                            <td>{exp.description}</td>
                                            <td style={{textAlign: 'right'}}>
                                                {isNumeric ? formatCurrency(parseFloat(exp.amount)) : exp.amount}
                                            </td>
                                            <td>{exp.mode}</td>
                                            <td>{exp.payee}</td>
                                        </tr>
                                    ) : null;
                                })}
                                <tr className="highlight-row">
                                    <td>Total amount to complete the transfer</td>
                                    <td style={{textAlign: 'right'}}>AED {formatCurrency(calculateBuyerTotal())}</td>
                                    <td>-</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>

                        <div className="note-section">
                            <strong>PLEASE NOTE:</strong> Kindly provide the Managers Cheque copies to your Sales CONVEYANCER within 24 hours in order to verify the names and numbers to avoid further delay. Your cooperation is highly appreciated!<br/>
                            In order to prepare Managers Cheques you will need to visit to your bank's branch.
                            <div style={{marginTop: '10px'}}>
                                <strong>Note:</strong><br/>
                                1. Outstanding Balance to Developer as of {formData.documentDate} â€“ AED {formatCurrency(getTotalOutstandingBalance())}<br/>
                                2. Buyer will pay to Developer â€“ AED {formatCurrency(getTotalBuyerPaidToDeveloper() || getTotalOutstandingBalance())}<br/>
                                3. Please note that the amount paid to the developer has not yet been deducted from the Net to Seller amount. It will be deducted when transferring the remaining balance to the seller's account<br/>
                                4. This Statement of Account is only a draft. All figures above are indicative and not final. Final amounts may vary at the time of transfer and are not guaranteed by InvestMenter Real Estate LLC.
                            </div>
                        </div>
                    </div>
                );
            };

            const renderSellerSOA = () => {
                const totalSellingPrice = getTotalSellingPrice();
                const totalOutstanding = getTotalOutstandingBalance();
                const totalBuyerPaidDeveloper = getTotalBuyerPaidToDeveloper();

                return (
                    <div id="seller-statement">
                        <div className="logo-container">
                            <img src="https://i.imgur.com/iyarNKS.png" alt="InvestMenter Logo" className="logo" crossOrigin="anonymous" />
                        </div>

                        <h2>SELLER STATEMENT OF ACCOUNT</h2>

                        <div className="document-info">
                            <div><strong>Document Date</strong> {formData.documentDate}</div>
                            <div><strong>Prepared by</strong> {formData.preparedBy}</div>
                        </div>

                        <div style={{marginBottom: '15px'}}>
                            <div className="info-row">
                                <div className="info-label">Sellers Name :</div>
                                <div className="info-value">{formData.sellersName || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Buyer Name :</div>
                                <div className="info-value">{formData.buyerName || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Property Address :</div>
                                <div className="info-value">{formData.propertyAddress || ''}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Estimated Transfer Date :</div>
                                <div className="info-value">{formData.estimatedTransferDate || 'TO BE CONFIRMED'}</div>
                            </div>
                            <div className="info-row">
                                <div className="info-label">Transfer Location & Time :</div>
                                <div className="info-value">{formData.transferLocation || 'TO BE CONFIRMED'}</div>
                            </div>
                        </div>

                        <div className="info-row" style={{marginBottom: '15px'}}>
                            <div className="info-label">Selling Price</div>
                            <div className="info-value">AED {formatCurrency(totalSellingPrice)}</div>
                        </div>

                        <table>
                            <thead>
                                <tr>
                                    <th>Remarks</th>
                                    <th style={{width: '150px'}}>Amount</th>
                                    <th style={{width: '150px'}}>Mode of Payment</th>
                                    <th style={{width: '180px'}}>Payee Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                {units.map((unit, index) => (
                                    <tr key={unit.id}>
                                        <td>Net to Seller{unit.name ? ` - ${unit.name}` : units.length > 1 ? ` - Unit ${index + 1}` : ''}</td>
                                        <td style={{textAlign: 'right'}}>{formatCurrency(getUnitNetToSeller(unit))}</td>
                                        <td>Manager's Cheque</td>
                                        <td>Investmenter Real Estate LLC</td>
                                    </tr>
                                ))}
                                <tr>
                                    <td><strong>Total Amount Sales Proceeds</strong></td>
                                    <td style={{textAlign: 'right'}}><strong>{formatCurrency(getNetToSeller())}</strong></td>
                                    <td>Manager's Cheque</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td><strong>Less:</strong></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Amount paid by Buyer to Developer</td>
                                    <td style={{textAlign: 'right'}}>{formatCurrency(totalBuyerPaidDeveloper || totalOutstanding)}</td>
                                    <td>Cash/Card</td>
                                    <td>Trustee Office</td>
                                </tr>
                                <tr>
                                    <td>Broker's Agency Fee incl. 5% VAT ({formData.brokerPercentage}%)</td>
                                    <td style={{textAlign: 'right'}}>{formatCurrency(getBrokerFee())}</td>
                                    <td>Manager's Cheque</td>
                                    <td>Investmenter Real Estate LLC</td>
                                </tr>
                                {sellerExpenses.map(exp => {
                                    const hasValidAmount = exp.amount && (!isNaN(parseFloat(exp.amount)) || exp.amount === 'TO BE CONFIRMED');
                                    const isNumeric = exp.amount && !isNaN(parseFloat(exp.amount));
                                    
                                    return hasValidAmount ? (
                                        <tr key={exp.id}>
                                            <td>{exp.description}</td>
                                            <td style={{textAlign: 'right'}}>
                                                {isNumeric ? formatCurrency(parseFloat(exp.amount)) : exp.amount}
                                            </td>
                                            <td>{exp.mode}</td>
                                            <td>{exp.payee}</td>
                                        </tr>
                                    ) : null;
                                })}
                                <tr className="highlight-row">
                                    <td>Final Sales Proceeds</td>
                                    <td style={{textAlign: 'right'}}>AED {formatCurrency(calculateSellerProceeds())}</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>

                        <div className="note-section">
                            <strong>PLEASE NOTE:</strong> Kindly provide the Managers Cheque copies to your Sales CONVEYANCER within 24 hours in order to verify the names and numbers to avoid further delay. Your cooperation is highly appreciated!<br/>
                            In order to prepare Managers Cheques you will need to visit to your bank's branch.
                        </div>
                    </div>
                );
            };

            return (
                <div className="container">
                    {!generated ? (
                        <div className="form-section">
                            <h1>ðŸ“„ Statement of Account Generator</h1>

                            <div className="section-header">Property Type</div>
                            <div className="property-type-selector">
                                <div 
                                    className={`property-type-option ${propertyType === 'offplan' ? 'active' : ''}`}
                                    onClick={() => setPropertyType('offplan')}
                                >
                                    Offplan
                                </div>
                                <div 
                                    className={`property-type-option ${propertyType === 'ready-cash' ? 'active' : ''}`}
                                    onClick={() => setPropertyType('ready-cash')}
                                >
                                    Ready / Cash
                                </div>
                                <div 
                                    className={`property-type-option ${propertyType === 'ready-mortgage' ? 'active' : ''}`}
                                    onClick={() => setPropertyType('ready-mortgage')}
                                >
                                    Ready / Mortgage
                                </div>
                            </div>

                            <div className="section-header">Buyer & Seller Type (for Sales Progression Fee)</div>
                            <div className="buyer-seller-type">
                                <div>
                                    <label>Buyer Type</label>
                                    <div className="type-selector">
                                        <div 
                                            className={`type-option ${buyerType === 'cash' ? 'active' : ''}`}
                                            onClick={() => setBuyerType('cash')}
                                        >
                                            Cash Buyer
                                        </div>
                                        <div 
                                            className={`type-option ${buyerType === 'mortgage' ? 'active' : ''}`}
                                            onClick={() => setBuyerType('mortgage')}
                                        >
                                            Mortgage Buyer
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label>Seller Type</label>
                                    <div className="type-selector">
                                        <div 
                                            className={`type-option ${sellerType === 'cash' ? 'active' : ''}`}
                                            onClick={() => setSellerType('cash')}
                                        >
                                            Cash Seller
                                        </div>
                                        <div 
                                            className={`type-option ${sellerType === 'mortgage' ? 'active' : ''}`}
                                            onClick={() => setSellerType('mortgage')}
                                        >
                                            Mortgage Seller
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="info-box">
                                <strong>Sales Progression Fee:</strong> AED {formatCurrency(getSalesProgressionFee())} 
                                <span style={{marginLeft: '10px', fontSize: '12px', color: '#666'}}>
                                    ({buyerType === 'cash' ? 'Cash' : 'Mortgage'} Buyer to {sellerType === 'cash' ? 'Cash' : 'Mortgage'} Seller)
                                </span>
                            </div>

                            <div className="section-header">Basic Information</div>
                            <div className="row">
                                <div className="form-group">
                                    <label>Seller's Name</label>
                                    <input 
                                        type="text" 
                                        value={formData.sellersName}
                                        onChange={(e) => setFormData({...formData, sellersName: e.target.value})}
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Buyer's Name</label>
                                    <input 
                                        type="text" 
                                        value={formData.buyerName}
                                        onChange={(e) => setFormData({...formData, buyerName: e.target.value})}
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Property Address</label>
                                <textarea 
                                    rows="2"
                                    value={formData.propertyAddress}
                                    onChange={(e) => setFormData({...formData, propertyAddress: e.target.value})}
                                />
                            </div>

                            <div className="row">
                                <div className="form-group">
                                    <label>Estimated Transfer Date</label>
                                    <input 
                                        type="text" 
                                        value={formData.estimatedTransferDate}
                                        onChange={(e) => setFormData({...formData, estimatedTransferDate: e.target.value})}
                                        placeholder="e.g., TO BE CONFIRMED"
                                    />
                                </div>
                                <div className="form-group">
                                    <label>Transfer Location & Time</label>
                                    <input 
                                        type="text" 
                                        value={formData.transferLocation}
                                        onChange={(e) => setFormData({...formData, transferLocation: e.target.value})}
                                        placeholder="e.g., TO BE CONFIRMED"
                                    />
                                </div>
                            </div>

                            <div className="form-group">
                                <label>Broker Percentage (%)</label>
                                <input 
                                    type="number" 
                                    step="0.1"
                                    value={formData.brokerPercentage}
                                    onChange={(e) => setFormData({...formData, brokerPercentage: e.target.value})}
                                    style={{width: '200px'}}
                                />
                            </div>

                            <div className="section-header">Property Units & Pricing</div>
                            {units.map((unit, index) => (
                                <div key={unit.id} className="unit-item">
                                    <div className="unit-header">
                                        <strong>Unit {index + 1}</strong>
                                        {units.length > 1 && (
                                            <button 
                                                className="btn btn-secondary btn-small"
                                                onClick={() => removeUnit(unit.id)}
                                            >
                                                Remove Unit
                                            </button>
                                        )}
                                    </div>
                                    <div className="form-group">
                                        <label>Unit Name/Number (Optional)</label>
                                        <input 
                                            type="text" 
                                            value={unit.name}
                                            onChange={(e) => updateUnit(unit.id, 'name', e.target.value)}
                                            placeholder="e.g., Unit 2002"
                                        />
                                    </div>
                                    <div className="row">
                                        <div className="form-group">
                                            <label>Purchase Price from Developer (AED)</label>
                                            <input 
                                                type="number" 
                                                className="amount-input"
                                                value={unit.purchasePrice}
                                                onChange={(e) => updateUnit(unit.id, 'purchasePrice', e.target.value)}
                                                placeholder="Original price"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Installment Paid by Seller (AED)</label>
                                            <input 
                                                type="number" 
                                                className="amount-input"
                                                value={unit.installmentPaid}
                                                onChange={(e) => updateUnit(unit.id, 'installmentPaid', e.target.value)}
                                                placeholder="Already paid"
                                            />
                                        </div>
                                    </div>
                                    <div className="breakdown-section" style={{fontSize: '13px', padding: '10px', marginBottom: '10px'}}>
                                        <strong>Outstanding Balance to Developer:</strong> AED {formatCurrency(getUnitOutstandingBalance(unit))}
                                    </div>
                                    <div className="row">
                                        <div className="form-group">
                                            <label>Selling Price (AED)</label>
                                            <input 
                                                type="number" 
                                                className="amount-input"
                                                value={unit.sellingPrice}
                                                onChange={(e) => updateUnit(unit.id, 'sellingPrice', e.target.value)}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label>Amount Paid by Buyer to Developer (AED) - Optional</label>
                                            <input 
                                                type="number" 
                                                className="amount-input"
                                                value={unit.buyerPaidToDeveloper}
                                                onChange={(e) => updateUnit(unit.id, 'buyerPaidToDeveloper', e.target.value)}
                                                placeholder="If buyer pays developer directly"
                                            />
                                        </div>
                                    </div>
                                    {propertyType === 'ready-mortgage' && (
                                        <div className="form-group">
                                            <label>FOL Amount (for Mortgage Registration Fee)</label>
                                            <input 
                                                type="number" 
                                                className="amount-input"
                                                value={unit.folAmount}
                                                onChange={(e) => updateUnit(unit.id, 'folAmount', e.target.value)}
                                                placeholder="Facility Offer Letter amount"
                                            />
                                        </div>
                                    )}
                                    <div className="breakdown-section" style={{fontSize: '13px', padding: '10px', background: '#e8f5e9'}}>
                                        <strong>Net to Seller (this unit):</strong> AED {formatCurrency(getUnitNetToSeller(unit))}
                                    </div>
                                </div>
                            ))}

                            <button className="btn btn-success btn-small" onClick={addUnit}>
                                + Add Another Unit
                            </button>

                            <div className="section-header">Buyer Statement Breakdown</div>
                            
                            <table className="expense-table">
                                <thead>
                                    <tr>
                                        <th>* Description of expenses*</th>
                                        <th style={{width: '150px'}}>Amount to be Prepared By Buyer</th>
                                        <th style={{width: '150px'}}>Mode of Payment</th>
                                        <th style={{width: '180px'}}>Payee Name</th>
                                        <th style={{width: '60px'}}>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {units.map((unit, index) => (
                                        <tr key={`net-to-seller-${unit.id}`} style={{background: '#f0f8ff'}}>
                                            <td style={{fontWeight: '500'}}>Net to Seller{unit.name ? ` - ${unit.name}` : units.length > 1 ? ` - Unit ${index + 1}` : ''}</td>
                                            <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getUnitNetToSeller(unit))}</td>
                                            <td>Manager's Cheque</td>
                                            <td>Investmenter Real Estate LLC</td>
                                            <td style={{textAlign: 'center'}}>-</td>
                                        </tr>
                                    ))}
                                    {getTotalBuyerPaidToDeveloper() > 0 && (
                                        <tr style={{background: '#fff3cd'}}>
                                            <td style={{fontWeight: '500'}}>Outstanding balance for NOC clearance</td>
                                            <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getTotalBuyerPaidToDeveloper())}</td>
                                            <td>Bank Transfer</td>
                                            <td>Developer</td>
                                            <td style={{textAlign: 'center'}}>-</td>
                                        </tr>
                                    )}
                                    <tr style={{background: '#f0f8ff'}}>
                                        <td style={{fontWeight: '500'}}>4% DLD Fee + AED {getDLDAdminFee()} Admin Fee{units.length > 1 ? ` x ${units.length} units` : ''}</td>
                                        <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getDLDFee())}</td>
                                        <td>Manager's Cheque</td>
                                        <td>Dubai Land Department</td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    <tr style={{background: '#f0f8ff'}}>
                                        <td style={{fontWeight: '500'}}>DLD Trustee Fee{units.length > 1 ? ` for ${units.length} Units` : ''}</td>
                                        <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getDLDTrusteeFee() * units.length)}</td>
                                        <td>Cash/Card</td>
                                        <td>Trustee Office</td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    <tr style={{background: '#f0f8ff'}}>
                                        <td style={{fontWeight: '500'}}>Broker's Agency Fee incl. 5% VAT ({formData.brokerPercentage}%)</td>
                                        <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getBrokerFee())}</td>
                                        <td>Manager's Cheque</td>
                                        <td>Investmenter Real Estate LLC</td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    {/* Auto-added expenses */}
                                    {buyerExpenses.filter(exp => ['sales-progression-auto', 'handling-admin-auto', 'mortgage-registration-auto'].includes(exp.id)).map(exp => (
                                        <tr key={exp.id} style={{
                                            background: (exp.id === 'sales-progression-auto' || exp.id === 'handling-admin-auto') ? '#fff9e6' : '#ffe6e6'
                                        }}>
                                            <td>
                                                <span style={{fontWeight: '500', color: '#666'}}>{exp.description}</span>
                                            </td>
                                            <td>
                                                <input 
                                                    type="text" 
                                                    className="amount-input"
                                                    value={exp.amount}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'amount', e.target.value)}
                                                    placeholder="0.00"
                                                    disabled={exp.id === 'mortgage-registration-auto' || exp.id === 'handling-admin-auto'}
                                                    style={{
                                                        background: (exp.id === 'mortgage-registration-auto' || exp.id === 'handling-admin-auto') ? '#f5f5f5' : 'white',
                                                        textAlign: 'right'
                                                    }}
                                                />
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.mode}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'mode', e.target.value)}
                                                    disabled={exp.id === 'mortgage-registration-auto' || exp.id === 'sales-progression-auto' || exp.id === 'handling-admin-auto'}
                                                >
                                                    {paymentModes.map(mode => (
                                                        <option key={mode} value={mode}>{mode}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.payee}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'payee', e.target.value)}
                                                    disabled={exp.id === 'mortgage-registration-auto' || exp.id === 'sales-progression-auto' || exp.id === 'handling-admin-auto'}
                                                >
                                                    {payeeOptions.map(option => (
                                                        <option key={option} value={option}>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td style={{textAlign: 'center'}}>
                                                <span style={{color: '#999', fontSize: '11px'}}>Auto</span>
                                            </td>
                                        </tr>
                                    ))}
                                    {/* Custom expenses */}
                                    {buyerExpenses.filter(exp => !['sales-progression-auto', 'handling-admin-auto', 'mortgage-registration-auto'].includes(exp.id)).map(exp => (
                                        <tr key={exp.id}>
                                            <td>
                                                <select 
                                                    value={exp.expenseType || 'other'}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'expenseType', e.target.value)}
                                                    style={{width: '100%', marginBottom: exp.expenseType === 'other' ? '5px' : '0'}}
                                                >
                                                    <option value="poa-no-eid">POA Fee (no Emirates ID) incl. 5% VAT</option>
                                                    <option value="poa-with-eid">POA Fee (with Emirates ID) incl. 5% VAT</option>
                                                    <option value="managers-cheque-fee">Manager's Cheque Fee (No Escrow Service) (10% Security Deposit)</option>
                                                    <option value="other">Other Cost</option>
                                                </select>
                                                {exp.expenseType === 'other' && (
                                                    <input 
                                                        type="text" 
                                                        value={exp.description}
                                                        onChange={(e) => updateBuyerExpense(exp.id, 'description', e.target.value)}
                                                        placeholder="Enter custom expense description"
                                                        style={{width: '100%'}}
                                                    />
                                                )}
                                            </td>
                                            <td>
                                                <input 
                                                    type="text" 
                                                    className="amount-input"
                                                    value={exp.amount}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'amount', e.target.value)}
                                                    placeholder="0.00"
                                                />
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.mode}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'mode', e.target.value)}
                                                >
                                                    {paymentModes.map(mode => (
                                                        <option key={mode} value={mode}>{mode}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.payee}
                                                    onChange={(e) => updateBuyerExpense(exp.id, 'payee', e.target.value)}
                                                >
                                                    {payeeOptions.map(option => (
                                                        <option key={option} value={option}>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td style={{textAlign: 'center'}}>
                                                <button 
                                                    className="btn-remove"
                                                    onClick={() => removeBuyerExpense(exp.id)}
                                                >
                                                    âœ•
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                    <tr style={{background: '#FFFF00'}}>
                                        <td style={{fontWeight: 'bold'}}>Total amount to complete the transfer</td>
                                        <td style={{textAlign: 'right', fontWeight: 'bold'}}>AED {formatCurrency(calculateBuyerTotal())}</td>
                                        <td>-</td>
                                        <td></td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                </tbody>
                            </table>
                            <button className="btn-add" onClick={addBuyerExpense}>
                                + Add Buyer Expense
                            </button>

                            <div className="info-box" style={{marginTop: '15px'}}>
                                <strong>ðŸ’¡ Quick Reference:</strong>
                                <ul style={{marginLeft: '20px', marginTop: '5px', fontSize: '12px'}}>
                                    <li><strong>Auto-added expenses (highlighted in yellow):</strong>
                                        <ul style={{marginLeft: '15px', marginTop: '3px'}}>
                                            <li>Sales Progression Fee: Amount varies by buyer/seller type (editable)</li>
                                            <li>Handling Admin Fee: AED 4,198.95 (fixed)</li>
                                            {propertyType === 'ready-mortgage' && (
                                                <li>DLD Mortgage Registration Fee: TO BE CONFIRMED (for Ready/Mortgage only)</li>
                                            )}
                                        </ul>
                                    </li>
                                    <li>POA Fee and Manager's Cheque Fee amounts are pre-filled when you select them</li>
                                    <li>Select "Other Cost" to add custom expenses</li>
                                </ul>
                            </div>

                            <div className="section-header">Seller Statement Breakdown</div>
                            
                            <table className="expense-table">
                                <thead>
                                    <tr>
                                        <th>Remarks</th>
                                        <th style={{width: '150px'}}>Amount</th>
                                        <th style={{width: '150px'}}>Mode of Payment</th>
                                        <th style={{width: '180px'}}>Payee Name</th>
                                        <th style={{width: '60px'}}>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {units.map((unit, index) => (
                                        <tr key={`seller-net-${unit.id}`} style={{background: '#f0f8ff'}}>
                                            <td style={{fontWeight: '500'}}>Net to Seller{unit.name ? ` - ${unit.name}` : units.length > 1 ? ` - Unit ${index + 1}` : ''}</td>
                                            <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getUnitNetToSeller(unit))}</td>
                                            <td>Manager's Cheque</td>
                                            <td>Investmenter Real Estate LLC</td>
                                            <td style={{textAlign: 'center'}}>-</td>
                                        </tr>
                                    ))}
                                    <tr style={{background: '#e8f5e9'}}>
                                        <td style={{fontWeight: 'bold'}}>Total Amount Sales Proceeds</td>
                                        <td style={{textAlign: 'right', fontWeight: 'bold'}}>{formatCurrency(getNetToSeller())}</td>
                                        <td>Manager's Cheque</td>
                                        <td></td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    <tr style={{background: '#fff3cd'}}>
                                        <td style={{fontWeight: 'bold'}}>Less:</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    <tr style={{background: '#f0f8ff'}}>
                                        <td style={{fontWeight: '500'}}>Amount paid by Buyer to Developer</td>
                                        <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getTotalBuyerPaidToDeveloper() || getTotalOutstandingBalance())}</td>
                                        <td>Cash/Card</td>
                                        <td>Trustee Office</td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    <tr style={{background: '#f0f8ff'}}>
                                        <td style={{fontWeight: '500'}}>Broker's Agency Fee incl. 5% VAT ({formData.brokerPercentage}%)</td>
                                        <td style={{textAlign: 'right', fontWeight: '500'}}>{formatCurrency(getBrokerFee())}</td>
                                        <td>Manager's Cheque</td>
                                        <td>Investmenter Real Estate LLC</td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                    {sellerExpenses.map(exp => (
                                        <tr key={exp.id}>
                                            <td>
                                                <select 
                                                    value={exp.expenseType || 'other'}
                                                    onChange={(e) => updateSellerExpense(exp.id, 'expenseType', e.target.value)}
                                                    style={{width: '100%', marginBottom: exp.expenseType === 'other' ? '5px' : '0'}}
                                                >
                                                    <option value="poa-no-eid">POA Fee (no Emirates ID) incl. 5% VAT</option>
                                                    <option value="poa-with-eid">POA Fee (with Emirates ID) incl. 5% VAT</option>
                                                    <option value="managers-cheque-fee">Manager's Cheque Fee (No Escrow Service) (10% Security Deposit)</option>
                                                    <option value="other">Other Cost</option>
                                                </select>
                                                {exp.expenseType === 'other' && (
                                                    <input 
                                                        type="text" 
                                                        value={exp.description}
                                                        onChange={(e) => updateSellerExpense(exp.id, 'description', e.target.value)}
                                                        placeholder="Enter custom expense description"
                                                        style={{width: '100%'}}
                                                    />
                                                )}
                                            </td>
                                            <td>
                                                <input 
                                                    type="text" 
                                                    className="amount-input"
                                                    value={exp.amount}
                                                    onChange={(e) => updateSellerExpense(exp.id, 'amount', e.target.value)}
                                                    placeholder="0.00"
                                                />
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.mode}
                                                    onChange={(e) => updateSellerExpense(exp.id, 'mode', e.target.value)}
                                                >
                                                    {paymentModes.map(mode => (
                                                        <option key={mode} value={mode}>{mode}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td>
                                                <select 
                                                    value={exp.payee}
                                                    onChange={(e) => updateSellerExpense(exp.id, 'payee', e.target.value)}
                                                >
                                                    {payeeOptions.map(option => (
                                                        <option key={option} value={option}>{option}</option>
                                                    ))}
                                                </select>
                                            </td>
                                            <td style={{textAlign: 'center'}}>
                                                <button 
                                                    className="btn-remove"
                                                    onClick={() => removeSellerExpense(exp.id)}
                                                >
                                                    âœ•
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                    <tr style={{background: '#FFFF00'}}>
                                        <td style={{fontWeight: 'bold'}}>Final Sales Proceeds</td>
                                        <td style={{textAlign: 'right', fontWeight: 'bold'}}>AED {formatCurrency(calculateSellerProceeds())}</td>
                                        <td></td>
                                        <td></td>
                                        <td style={{textAlign: 'center'}}>-</td>
                                    </tr>
                                </tbody>
                            </table>
                            <button className="btn-add" onClick={addSellerExpense}>
                                + Add Seller Expense
                            </button>

                            <div className="info-box" style={{marginTop: '15px'}}>
                                <strong>ðŸ’¡ Quick Reference:</strong>
                                <ul style={{marginLeft: '20px', marginTop: '5px', fontSize: '12px'}}>
                                    <li>POA Fee and Manager's Cheque Fee amounts are pre-filled when you select them</li>
                                    <li>Select "Other Cost" to add custom expenses</li>
                                </ul>
                            </div>

                            <div className="breakdown-section">
                                <h3>Quick Summary</h3>
                                <div className="breakdown-row">
                                    <span>Total Selling Price:</span>
                                    <span>AED {formatCurrency(getTotalSellingPrice())}</span>
                                </div>
                                <div className="breakdown-row">
                                    <span>Net to Seller (before expenses):</span>
                                    <span>AED {formatCurrency(getNetToSeller())}</span>
                                </div>
                                <div className="breakdown-row total" style={{color: '#28a745'}}>
                                    <span><strong>Total Buyer Needs to Prepare:</strong></span>
                                    <span><strong>AED {formatCurrency(calculateBuyerTotal())}</strong></span>
                                </div>
                                <div className="breakdown-row total" style={{color: '#C9A961'}}>
                                    <span><strong>Seller Final Proceeds:</strong></span>
                                    <span><strong>AED {formatCurrency(calculateSellerProceeds())}</strong></span>
                                </div>
                            </div>

                            <div className="btn-group">
                                <button className="btn btn-primary" onClick={handleGenerate}>
                                    ðŸš€ Generate Both SOAs
                                </button>
                                <button className="btn btn-secondary" onClick={handleReset}>
                                    Reset Form
                                </button>
                            </div>
                        </div>
                    ) : (
                        <>
                            <div className="alert">
                                âœ… Statements generated successfully! You can now download PDFs or edit the statements below.
                            </div>

                            <div className="btn-group">
                                <button className="btn btn-primary" onClick={() => downloadPDF('buyer')}>
                                    ðŸ“¥ Download Buyer SOA (PDF)
                                </button>
                                <button className="btn btn-primary" onClick={() => downloadPDF('seller')}>
                                    ðŸ“¥ Download Seller SOA (PDF)
                                </button>
                                <button className="btn btn-secondary" onClick={() => setGenerated(false)}>
                                    â† Back to Form
                                </button>
                                <button className="btn btn-secondary" onClick={handleReset}>
                                    Reset All
                                </button>
                            </div>

                            <div className="tabs">
                                <div 
                                    className={`tab ${activeTab === 'buyer' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('buyer')}
                                >
                                    Buyer Statement
                                </div>
                                <div 
                                    className={`tab ${activeTab === 'seller' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('seller')}
                                >
                                    Seller Statement
                                </div>
                            </div>

                            {activeTab === 'buyer' ? (
                                <div className="statement-preview">
                                    {renderBuyerSOA()}
                                </div>
                            ) : (
                                <div className="statement-preview">
                                    {renderSellerSOA()}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        }

        ReactDOM.render(<SOAGenerator />, document.getElementById('root'));
    </script>
</body>
</html>
